apt update && apt install -y build-essential libgl1-mesa-dev wget libfontconfig1 libxrender1  libdbus-1-3 libxkbcommon0 libxkbcommon-x11-0 xvfb libpulse-dev 
apt install -y      libfontconfig1-dev     libfreetype6-dev     libx11-dev     libxext-dev     libxfixes-dev     libxi-dev     libxrender-dev     libxcb1-dev     libx11-xcb-dev     libxcb-glx0-dev     libxkbcommon-x11-dev     libxcb-keysyms1-dev     libxcb-image0-dev     libxcb-shm0-dev     libxcb-icccm4-dev     libxcb-sync0-dev     libxcb-xfixes0-dev     libxcb-shape0-dev     libxcb-randr0-dev     libxcb-render-util0-dev  libxkbcommon-dev libicu-dev libxcb-xinerama0-dev libegl1-mesa-dev  libxcomposite-dev libxcursor-dev libxtst-dev libxrandr-dev
apt-get install -y libdbus-1-dev libnss3-dev
apt-get install -y gperf bison flex

QT_VERSION=5.15.0
QT_MAJOR_MINOR="${QT_VERSION%.*}"

wget https://download.qt.io/official_releases/qt/${QT_MAJOR_MINOR}/${QT_VERSION}/submodules/qtbase-everywhere-src-${QT_VERSION}.tar.xz
wget https://download.qt.io/official_releases/qt/${QT_MAJOR_MINOR}/${QT_VERSION}/submodules/qtwebengine-everywhere-src-${QT_VERSION}.tar.xz
wget https://download.qt.io/official_releases/qt/${QT_MAJOR_MINOR}/${QT_VERSION}/submodules/qtmultimedia-everywhere-src-${QT_VERSION}.tar.xz
wget https://download.qt.io/official_releases/qt/${QT_MAJOR_MINOR}/${QT_VERSION}/submodules/qtdeclarative-everywhere-src-${QT_VERSION}.tar.xz

for file in *.xz; do
    tar xf "$file" && rm "$file"
done

set -e
cd qtbase*
mkdir build
cd build
../configure -prefix /opt/qt5 -release -opensource -confirm-license -xcb
read
make -j$(nproc) && make install
cd ../../

cd qtmultimedia*
mkdir build && cd build
/opt/qt5/bin/qmake ../
make -j$(nproc) && make install
cd ../../

cd qtdeclarative*
mkdir build && cd build
/opt/qt5/bin/qmake ../
make -j$(nproc) && make install
cd ../../

cd qtwebengine*
rm -rf examples
mkdir build && cd build
/opt/qt5/bin/qmake ../
make -j$(nproc) && make install

